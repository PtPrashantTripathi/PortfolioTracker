<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Candlestick Chart</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            font-family: Arial, sans-serif;
        }
        #chart {
            flex-grow: 1;
        }
        #range-switcher {
            display: flex;
            justify-content: center;
            padding: 10px;
            background-color: #f4f4f4;
        }
        .button {
            margin: 0 5px;
            padding: 10px;
            cursor: pointer;
            background-color: #26a69a;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        .button:hover {
            background-color: #1e7b6e;
        }
    </style>
</head>

<body>
    <div id="chart"></div>
    <div id="range-switcher">
        <button class="button" data-range="1d">1D</button>
        <button class="button" data-range="5d">5D</button>
        <button class="button" data-range="1m">1M</button>
        <button class="button" data-range="3m">3M</button>
        <button class="button" data-range="6m">6M</button>
        <button class="button" data-range="1y">1Y</button>
        <button class="button" data-range="all">All</button>
    </div>

    <script>
        // Chart configuration options
        const chartOptions = {
            layout: {
                backgroundColor: '#f4f4f4',
                textColor: '#333',
                fontSize: 14,
                fontFamily: 'Arial, sans-serif'
            },
            grid: {
                vertLines: {
                    color: '#e1e1e1',
                    style: LightweightCharts.LineStyle.Dotted,
                    visible: true
                },
                horzLines: {
                    color: '#e1e1e1',
                    style: LightweightCharts.LineStyle.Dotted,
                    visible: true
                }
            },
            crosshair: {
                mode: LightweightCharts.CrosshairMode.Normal,
                vertLine: {
                    color: '#6a5acd',
                    width: 1,
                    style: LightweightCharts.LineStyle.Solid,
                    visible: true,
                    labelVisible: true
                },
                horzLine: {
                    color: '#6a5acd',
                    width: 1,
                    style: LightweightCharts.LineStyle.Solid,
                    visible: true,
                    labelVisible: true
                }
            },
            rightPriceScale: {
                mode: LightweightCharts.PriceScaleMode.Normal,
                borderVisible: false,
            },
            timeScale: {
                timeVisible: true,
                secondsVisible: false,
                borderVisible: false,
            },
            handleScroll: {
                mouseWheel: true,
                pressedMouseMove: true,
            },
            handleScale: {
                axisPressedMouseMove: true,
                pinch: true,
            }
        };

        // Initialize the chart
        const chart = LightweightCharts.createChart(document.getElementById('chart'), chartOptions);
        const candlestickSeries = chart.addCandlestickSeries({
            upColor: '#26a69a',
            downColor: '#ef5350',
            borderVisible: false,
            wickUpColor: '#26a69a',
            wickDownColor: '#ef5350'
        });

        // Fetch and prepare data
        async function fetchDataAndPrepare() {
            try {
                // Verify the file path and serve from a local server
                const response = await fetch('../DATA/GOLD/Holdings/Holdings_data_v3.json');

                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                const data = await response.json();

                // Log the data to check its structure
                console.log("Raw data fetched:", data[0]);

                // Transform the date from milliseconds to seconds
                const processedData = data.map(item => ({
                    time: new Date(item.date).getTime() / 1000,  // Convert to seconds
                    open: item.open_amount,
                    high: item.high_amount,
                    low: item.low_amount,
                    close: item.close_amount,
                }));

                console.log("Processed data for chart:", processedData[0]);

                candlestickSeries.setData(processedData); // Load data into the chart
                chart.timeScale().fitContent(); // Auto-fit the chart to display all data
            } catch (error) {
                console.error("Error fetching or processing data:", error);
            }
        }

        // Run the functions to fetch data and initialize the range switcher
        fetchDataAndPrepare();
    </script>
</body>

</html>
