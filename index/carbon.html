<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Visualization</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Carbon Charts CSS -->
    <link href="https://unpkg.com/@carbon/charts@1.19.2/dist/styles.css" rel="stylesheet">
</head>
<body class="container py-5">
    <div class="text-center mb-4">
        <h1>Data Visualization</h1>
    </div>

    <div class="d-flex justify-content-center mb-4">
        <button id="yearly" class="btn btn-primary mx-2">Yearly</button>
        <button id="yearMonth" class="btn btn-secondary mx-2">Year-Month</button>
        <button id="yearWeek" class="btn btn-success mx-2">Year-Week</button>
    </div>

    <div id="chart" style="height: 400px;"></div>

    <!-- Carbon Charts JS -->
    <script src="https://unpkg.com/@carbon/charts@1.19.2/dist/umd/bundle.umd.js"></script>


    <script>
        function generateRandomData(startDate, endDate) {
    let data = [];
    let value = 1000;
    let currentDate = new Date(startDate);

    while (currentDate <= endDate) {
        value += Math.floor(Math.random() * 100)-50;
        data.push({ date: new Date(currentDate).toISOString().split('T')[0], value: value }); // Format date to 'YYYY-MM-DD'
        currentDate.setDate(currentDate.getDate() + 1); // Increment the date by 1 day
    }

    return data;
}

// Example usage:
let start = new Date('2022-01-01');
let end = new Date();
let data = generateRandomData(start, end);

console.log(data);



        // Aggregation Functions
        function getWeek(dateString) {
            let date = new Date(dateString);
            let dayNum = date.getUTCDay() || 7;
            date.setUTCDate(date.getUTCDate() + 4 - dayNum);
            let yearStart = new Date(Date.UTC(date.getUTCFullYear(), 0, 1));
            let weekNum = Math.ceil((((date - yearStart) / 86400000) + 1) / 7);
            return `${date.getUTCFullYear()}-W${weekNum.toString().padStart(2, '0')}`;
        }

        function aggregateData(data, keyFunc) {
            return data.reduce((acc, current) => {
                let key = keyFunc(current.date);
                if (!acc[key] || current.date > acc[key].date) {
                    acc[key] = current;
                }
                return acc;
            }, {});
        }

        // Initial Chart Rendering (Yearly by Default)
        let chart = new Charts.LineChart(document.getElementById("chart"), {
            data: data,
            options: {
                title: "Yearly Data",
                axes: {
                    bottom: {
                        title: "Date",
                        mapsTo: "date",
                        scaleType: "time"
                    },
                    left: {
                        title: "Value",
                        mapsTo: "value",
                        scaleType: "linear"
                    }
                },
                height: "400px"
            }
        });

        // Button Handlers
        document.getElementById("yearly").addEventListener("click", () => {
            chart.model.setData(Object.values(aggregateData(data, date => date.slice(0, 4))));
            chart.options.title = "Yearly Data";
            chart.update();
        });

        document.getElementById("yearMonth").addEventListener("click", () => {
            chart.model.setData(Object.values(aggregateData(data, date => date.slice(0, 7))));
            chart.options.title = "Year-Month Data";
            chart.update();
        });

        document.getElementById("yearWeek").addEventListener("click", () => {
            chart.model.setData(Object.values(aggregateData(data, getWeek)));
            chart.options.title = "Year-Week Data";
            chart.update();
        });

        console.log("45");
    </script>
</body>
</html>
